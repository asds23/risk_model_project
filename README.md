# Risk Model Project

Проект для предсказания рисков на мультимодальных маршрутах (авто, ж/д, авиа, морской транспорт) с использованием данных MET.NO и модели множественной регрессии.

---

## Структура проекта

### 1. `data_fetching_and_risk_mapping.py`

* Получение погодных данных с MET.NO по координатам.
* Преобразование данных в расширенные показатели риска (0–10) для различных погодных условий.
* Основная функция: `get_point_risk(lat, lon)` — возвращает риск для конкретной точки.

### 2. `route_module.py`

* Построение мультимодального маршрута из начальной и конечной точек.
* Разделение маршрута на сегменты и расчёт модульного риска для каждого сегмента.
* Вспомогательные функции:

  * `haversine` — расстояние между точками,
  * `compute_module_risk` — расчёт риска модуля,
  * `build_multimodal_route` — построение маршрута.
* Экспорт маршрута: `save_route_json`, `save_route_csv`.
* Демонстрация использования: функция `demo()`.

### 3. `ml_model.py`

* Ядро модели множественной регрессии (`RiskMultiRegressor`).
* Поддержка обучения (`fit`), сохранения (`save`) и загрузки модели (`load`).
* Утилиты:

  * `aggregate_route_features` — сбор признаков маршрута,
  * `route_from_addresses` — построение маршрута по адресам и сбор признаков.

### 4. `train_risk_model_large.py`

* Генерация большого набора обучающих маршрутов.
* Вычисление признаков маршрутов и целевых значений — средних рисков по модулю.
* Обучение модели `RiskMultiRegressor` и сохранение её в файл `risk_model_trained_large.pkl`.
* Вывод информации по геоданным маршрутов.

### 5. `test_model.ipynb` (пример)

* Загрузка обученной модели.
* Тестирование модели на конкретном маршруте.
* Просмотр признаков маршрута и предсказанных рисков.
* Подробная информация по сегментам маршрута для наглядности.

---

## Рекомендованная последовательность использования

1. **Сбор данных и проверка функций риска по точкам**

```python
from data_fetching_and_risk_mapping import get_point_risk
get_point_risk(55.7558, 37.6176)  # пример: Москва
```

2. **Построение мультимодального маршрута**

```python
from route_module import build_multimodal_route
route = build_multimodal_route((55.7558,37.6176), (59.9311,30.3609), modules=["truck","rail"], segments_per_leg=3)
```

3. **Обучение модели на большом наборе маршрутов**

```bash
python train_risk_model_large.py
```

4. **Тестирование модели на новом маршруте**

* Использовать `test_model.ipynb` или Python:

```python
from ml_model import RiskMultiRegressor, route_from_addresses
model = RiskMultiRegressor()
model.load("risk_model_trained_large.pkl")
route = route_from_addresses("ул. Пушкина, 12, Воронеж", "ул. Советская, 55, Ростов-на-Дону", ["truck","rail"])
predicted_risks = model.predict(route)
```

---

## Зависимости

* Python 3.8+
* pandas, numpy, scikit-learn, joblib, requests

---

## Цель проекта

* Автоматическое предсказание рисков для мультимодальных маршрутов с учётом погодных условий.
* Интеграция в логистические системы для оценки опасностей на каждом этапе маршрута.
